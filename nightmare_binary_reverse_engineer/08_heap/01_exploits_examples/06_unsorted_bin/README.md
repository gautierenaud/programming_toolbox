# Unsorted bin

This exploit seems to work for libc versions prior to tcache (say 2.23).

Quite similarily to fastbin attack, this exploit is based on the behavior of memory chunks in the unsorted bin in order to write an address at the place we like.

In order to do so, we have to first allocate a chunk big enough so that once freed it would go to unsorted bin. Once there it will have the address to main_arena written in the first two words. If we change (with an UAF ? overwrite from a previous memory chunk ?) the second address (bk pointer) to anything else, we will then write at that address upon allocating that chunk.

At the destination will be written an address to main_arena, so the destination might be something we can print (so we can leak main_arena's address).

# shellphish unsafe unlink

This one explains how to create a fake chunk within unsorted bin. It supposes we know the location of the pointers, and that we have an overflow bug.

Preparation:
```bash
0x555555559290:	0x0000000000000000	0x0000000000000431  <- actual chunk header>
0x5555555592a0:	0x0000000000000000	0x0000000000000421  <- fake chunk header>
0x5555555592b0:	0x0000555555558008	0x0000555555558010  <- fake fd and bk pointers>
```
The fake pointers are here to pass sanity checks, so we can pass `(P->fd->bk != P || P->bk->fd != P) == False` test.
```bash
gef➤  x/6gx 0x0000555555558008
0x555555558008:	0x0000555555558008	0x00007ffff7fa96a0
0x555555558018:	0x0000000000000000	0x00005555555592a0  <- second value is the address of our actual chunk >
0x555555558028:	0x0000000000000000	0x0000000000000000
```
So from the fake chunk's perspective, P->fd is `0x0000555555558008`, and `0x0000555555558008`->bk is `0x00005555555592a0`. Similar reasonning for the other condition.

We will then need to overwrite header information of the following chunk, so that it will point to our fake chunk instead of the original chunk:
```bash
gef➤  x/10gx 0x00005555555596c0
0x5555555596c0:	0x0000000000000420	0x0000000000000430  <- header values of following chunk>
0x5555555596d0:	0x0000000000000000	0x0000000000000000
```

And after the free:
```bash
0x555555558020 <chunk0_ptr>:	0x0000555555558008	0x0000000000000000
0x555555558030:	0x0000000000000000	0x0000000000000000
```
So now chunk0_ptr is pointing at a location just above itself. So we can edit where chunk0_ptr is pointing at !